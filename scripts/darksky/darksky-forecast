#!/usr/bin/env crystal

require "colorize"
require "./darksky/*"
require "yaml"

class Config
  YAML.mapping(locations: Array(Location))

  class Location
    YAML.mapping(name: String, latitude: Float64, longitude: Float64)
  end
end

path = File.expand_path("~/.darkskyconfig.yaml")
text = File.read(path)
conf = Config.from_yaml(text)
client = DarkSky::Client.new(ENV["DARKSKY_AUTH_TOKEN"])

responses = {} of String => DarkSky::Forecast

conf.locations.each do |location|
  responses[location.name] = client.forecast(location.latitude, location.latitude)
end

responses.each do |name, forecast|
  printf("%s\n", name)
  printf(
    "• %.1f˚F %s\n",
    forecast.currently.temperature,
    forecast.currently.summary
  )
  printf("• %s\n", forecast.daily.summary)
  puts
end
