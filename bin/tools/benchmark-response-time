#!/usr/bin/env bash

set -euo pipefail

if ! command -v hyperfine  &> /dev/null; then
    echo "hyperfine not found"
    exit 1
elif ! command -v jq &> /dev/null; then
    echo "jq not found"
    exit 1
fi

url=$1
runs=${2:-100}
timestamp=$(date +%s)
base_filename="${url//\//-}-$timestamp"

hyperfine "curl --compressed https://$url" \
   --runs $runs \
   --warmup 10 \
   --export-json=$base_filename.json

cat $base_filename.json | jq -r '.results[0].times | join("\n")' > $base_filename.csv
